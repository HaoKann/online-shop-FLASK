{% extends 'admin/base.html' %}
{% from 'bootstrap5/form.html' import render_form %}
{% from 'bootstrap5/pagination.html' import render_pagination %}

{% block content %}
<div class="container"> 

    <div class="page-header">
        <h1>Все продукты</h1>
        <a href="{{ url_for('admin.admin_add_product') }}" class="btn btn-primary">
            <i class="bi bi-plus-lg"></i> Добавить новый продукт
        </a>
    </div>

    <form class="d-flex mb-4" role="search" action="{{ url_for('search.admin_search') }}" method="GET">
        <input class="form-control me-2" name="q" placeholder="Поиск по названию..." aria-label="Search">
        <button class="btn btn-outline-light" type="submit">Поиск</button>
    </form>

    {% if products.items %}
        <div class="table-responsive">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th style="width: 10%;">Фото</th>
                        <th>Название</th>
                        <th>Категория</th>
                        <th>Цена</th>
                        <th class="text-end">Действия</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products.items %}
                        <tr>
                            <td>
                                <img src="{{ product.get_first_photo() }}" alt="{{ product.name }}" class="table-product-img">
                            </td>
                            <td>{{ product.name }}</td>
                            <td>{{ product.get_category_name() }}</td>
                            <td>{{ "{:,.0f}".format(product.price).replace(",", " ") }} ₸</td>
                            <td class="text-end">
                                <div class="table-actions">
                                    <a href="{{ url_for('admin.admin_product', id=product.id) }}" class="action-icon action-edit" title="Редактировать">
                                        <i class="bi bi-pencil-square"></i>
                                    </a>
                                    <a href="{{ url_for('admin.admin_delete_products', id=product.id) }}" class="action-icon action-delete" title="Удалить">
                                        <i class="bi bi-trash-fill"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <nav aria-label="Page navigation" class="mt-4 d-flex justify-content-center">
            {{ render_pagination(products, endpoint='admin.admin_products_list') }}
        </nav>

    {% else %}
        <p class="text-muted">Товаров пока нет.</p>
    {% endif %}
</div>
{% endblock %}