{% extends 'admin/base.html' %}
{% from 'bootstrap5/form.html' import render_form %}

{% block content %}
    <div class="page-header">
        <h1>Все продукты</h1>
        <a href="{{ url_for('admin_add_product') }}" class="btn btn-primary">
            <i class="bi bi-plus-lg"></i> Добавить новый продукт
        </a>
    </div>

    <form class="d-flex mb-4" role="search" action="{{ url_for('admin_search') }}" method="GET">
        <input class="form-control me-2" name="q" placeholder="Поиск по названию..." aria-label="Search">
        <button class="btn btn-outline-light" type="submit">Поиск</button>
    </form>

    {% if products.items %}
        <div class="table-responsive">
            <table class="table admin-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th style="width: 10%;">Фото</th>
                        <th>Название</th>
                        <th>Категория</th>
                        <th>Цена</th>
                        <th>Скидка</th>
                        <th class="text-end">Действия</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products.items %}
                        <tr>
                            <td>{{ product.id }}</td>
                            <td>
                                <img src="{{ product.get_first_photo() }}" alt="{{ product.name }}" class="table-product-img">
                            </td>
                            <td>{{ product.name }}</td>
                            <td>{{ product.get_category_name() }}</td>
                            <td>{{ "{:,.0f}".format(product.price).replace(",", " ") }} ₸</td>
                            <td>{% if product.discount %}{{ product.discount }}%{% else %}-{% endif %}</td>
                            
                            <td class="table-actions">
                                <a href="{{ url_for('admin_edit_product', id=product.id) }}" class="action-icon action-edit" title="Редактировать">
                                    <i class="bi bi-pencil-fill"></i>
                                </a>
                                <a href="{{ url_for('admin_delete_products', id=product.id) }}" class="action-icon action-delete" title="Удалить">
                                    <i class="bi bi-trash3-fill"></i>
                                </a>
                                <a href="{{ url_for('admin_product', id=product.id) }}" class="action-icon action-view" title="Детали">
                                    <i class="bi bi-eye-fill"></i>
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <nav aria-label="Page navigation" class="mt-4">
            <ul class="pagination justify-content-center">
                {% if products.has_prev %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('admin_products_list', page=products.prev_num) }}">«</a>
                    </li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">«</span></li>
                {% endif %}
                
                {% for page_num in products.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=3) %}
                    {% if page_num %}
                        <li class="page-item {% if page_num == products.page %}active{% endif %}">
                            <a class="page-link" href="{{ url_for('admin_products_list', page=page_num) }}">{{ page_num }}</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled"><span class="page-link">…</span></li>
                    {% endif %}
                {% endfor %}

                {% if products.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('admin_products_list', page=products.next_num) }}">»</a>
                    </li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">»</span></li>
                {% endif %}
            </ul>
        </nav>

    {% else %}
        <p class="text-muted">Товаров пока нет.</p>
    {% endif %}

{% endblock %}