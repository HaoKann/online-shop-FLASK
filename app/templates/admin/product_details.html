{% extends 'admin/base.html' %}
{% from 'bootstrap5/form.html' import render_form %}

{% block content %}
    <div class="page-header">
        <h1>Детали продукта: {{ product.name }}</h1>
        <a href="{{ url_for('admin.admin_products_list') }}" class="btn btn-outline-light">
            <i class="bi bi-arrow-left"></i> К списку продуктов
        </a>
    </div>

    <div class="row g-4">
        <div class="col-lg-8">
            <div class="admin-card">
                <h5 class="admin-card-title">Основная информация</h5>
                <dl class="row">
                    <dt class="col-sm-3">ID</dt>
                    <dd class="col-sm-9">{{ product.id }}</dd>
                    
                    <dt class="col-sm-3">Название</dt>
                    <dd class="col-sm-9">{{ product.name }}</dd>

                    <dt class="col-sm-3">Категория</dt>
                    <dd class="col-sm-9">{{ product.get_category_name() }}</dd>

                    <dt class="col-sm-3">Цена</dt>
                    <dd class="col-sm-9">{{ "{:,.0f}".format(product.price).replace(",", " ") }} ₸</dd>

                    <dt class="col-sm-3">Скидка</dt>
                    <dd class="col-sm-9">{{ product.discount or 0 }}%</dd>
                </dl>
            </div>

            <div class="admin-card mt-4">
    <h5 class="admin-card-title">Характеристики</h5>

    {% if product.characteristics.count() > 0 %}
        <dl class="row">
            {% for spec in product.characteristics %}
                <dt class="col-sm-5">{{ spec.name }}</dt>

                <dd class="col-sm-7 d-flex justify-content-between align-items-center">
    
                <span>{{ spec.int_value or spec.str_value }}</span>
                
                {# Оборачиваем обе кнопки в один div, чтобы они были вместе #}
                <div class="d-flex">
                    
                    <a href="{{ url_for('admin.edit_characteristic', characteristic_id=spec.id) }}" class="action-icon action-edit me-2" title="Редактировать">
                        <i class="bi bi-pencil-fill"></i> 
                    </a>

                    <form action="{{ url_for('admin.admin_delete_characteristic', characteristic_id=spec.id) }}" 
                        method="POST" 
                        onsubmit="return confirm('Вы уверены, что хотите удалить эту характеристику?');"
                        class="ms-2">
                        
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-sm btn-outline-danger" title="Удалить характеристику">
                            <i class="bi bi-trash-fill"></i>
                        </button>
                    </form>

                </div>

            </dd>
            {% endfor %}
        </dl>
    {% else %}
        <p class="text-muted">Для этого товара характеристики ещё не добавлены.</p>
    {% endif %}
</div>

            <div class="admin-card mt-4">
                <h5 class="admin-card-title">Фотографии</h5>
                <div class="row g-3">
                    {% if product.photos.count() > 0 %}
                        {% for photo in product.photos %}
                            <div class="col-4">
                                <img src="{{ photo.get_photo() }}" 
                                    alt="Фото продукта: {{ product.name }}" 
                                    class="img-fluid rounded" 
                                    style="max-height: 150px; object-fit: cover;">
                                <small class="text-muted">{{ photo.description or 'Без описания' }}</small>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted">Фотографий нет.</p>
                        <img src="{{ product.get_first_photo() }}" alt="Фото по умолчанию" class="img-fluid rounded" style="max-height: 150px; object-fit: cover;">
                    {% endif %}
                </div>
            </div>

            <div class="admin-form-card mt-4">
                <h6 class="admin-card-title">Загрузить фото</h6>
                <form method="POST" enctype="multipart/form-data">
                    {{ photo_form.hidden_tag() }}
                    {{ render_form(photo_form) }}
                </form>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="admin-form-card mb-4">
                <h6 class="admin-card-title">Редактировать товар</h6>
                <form method="POST" action="">
                    {{ edit_form.hidden_tag() }}
                    {{ render_form(edit_form) }}
                </form>
            </div>
            
            <div class="admin-form-card mb-4">
                <h6 class="admin-card-title">Добавить характеристику</h6>
                <form method="POST" action="">
                    {{ characteristics_form.hidden_tag() }}
                    {{ render_form(characteristics_form) }}
                </form>
            </div>
        </div>
    </div>
{% endblock %}